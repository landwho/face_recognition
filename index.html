<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Signup Form</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="pages.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<style>
    #video, #photo { width: 100%; }
    #photo { display: none; }
    .center-text{ text-align: center;}
    .center-buttons{ display: flex; justify-content: center; }
</style>
</head>
<body>
    
<div class="card">
    <h2>Signup Form</h2>
    <div class="login_register">
        <a href="login.html" class="login">Login</a>
        <a href="index.html" class="register">Signup</a>
    </div>
    <form class="form" id="signup-form">
        <input type="text" placeholder="Username" class="username" required>
        <br>
        <div id="video-container">
            <video id="video" autoplay playsinline></video>
            <img id="photo" alt="Captured photo">
            <div class="center-buttons">
                <button type="button" class="btn btn-dark" id="capture-button" style="display: none;">
                    Take <i class="fa fa-camera" aria-hidden="true"></i>
                </button>
                <button type="button" class="btn btn-dark" id="retake-button" style="display: none;">
                    Retake <i class="fa fa-camera" aria-hidden="true"></i>
                </button>
            </div>
        </div>
        <button type="submit" class="login_btn">Signup</button>
    </form>
    <div class="center-text">
        <a id="turn-on-camera-button" class="fp pointer">Turn on Camera</a>
    </div>
</div>
<script>
    const video = document.getElementById('video');
    const turnOnCameraButton = document.getElementById('turn-on-camera-button');
    const captureButton = document.getElementById('capture-button');
    const retakeButton = document.getElementById('retake-button');
    const usernameField = document.querySelector('.username');
    const photo = document.getElementById('photo');
    const signupForm = document.getElementById('signup-form');

    let stream;
    let imageData;

    function turnOnCamera() {
        navigator.mediaDevices.getUserMedia({ video: true })
        .then(mediaStream => {
            stream = mediaStream;
            video.srcObject = stream;
            turnOnCameraButton.style.display = 'none'; 
            captureButton.style.display = 'block'; 
            retakeButton.style.display = 'none';
            video.style.display = 'block';
            photo.style.display = 'none';
        })
        .catch(error => {
            console.error('Error accessing the camera:', error);
        });
    }

    function turnOffCamera() {
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
    }

    turnOnCameraButton.addEventListener('click', turnOnCamera);

    captureButton.addEventListener('click', () => {
        const username = usernameField.value;
        if (!username) {
            alert('Please enter a username before capturing the image.');
            return;
        }

        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const context = canvas.getContext('2d');
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        imageData = canvas.toDataURL('image/jpeg');

        photo.src = imageData;
        photo.style.display = 'block';
        video.style.display = 'none';
        captureButton.style.display = 'none';
        retakeButton.style.display = 'block';

        turnOffCamera();
    });

    retakeButton.addEventListener('click', turnOnCamera);

    signupForm.addEventListener('submit', (event) => {
        event.preventDefault(); 

        const username = usernameField.value;
        if (!username) {
            alert('Please enter a username.');
            return;
        }

        if (!imageData) {
            alert('Please capture an image.');
            return;
        }

        fetch('http://127.0.0.1:5000/guardar_imagen', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                image: imageData,
                username: username
            })
        })
        .then(response => {
            if (response.ok) {
                alert('Signup successful!');
                window.location.href = 'login.html';  // Redirect to login page
            } else {
                console.error('Error sending the data to the server.');
            }
        })
        .catch(error => {
            alert('Error sending the data to the server:', error);
        });
    });
</script>
</body>
</html>





